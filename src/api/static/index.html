<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>BFSI Conversational AI</title>
  <style>
    :root {
      --bg: #0b0f14;
      --panel: #111827;
      --accent: #22c55e;
      --accent-2: #f59e0b;
      --text: #e5e7eb;
      --muted: #9ca3af;
      --border: #1f2937;
      --shadow: rgba(0, 0, 0, 0.35);
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: "IBM Plex Sans", "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      background: radial-gradient(1200px 800px at 10% 10%, #0f172a, #05070a);
      color: var(--text);
      height: 100vh;
      display: grid;
      place-items: center;
    }

    .app {
      width: min(980px, 92vw);
      height: min(720px, 92vh);
      background: linear-gradient(180deg, #0f172a, #0b1220);
      border: 1px solid var(--border);
      border-radius: 24px;
      box-shadow: 0 30px 80px var(--shadow);
      display: grid;
      grid-template-rows: auto 1fr auto;
      overflow: hidden;
    }

    .header {
      padding: 20px 24px;
      border-bottom: 1px solid var(--border);
      background: linear-gradient(120deg, rgba(34,197,94,0.18), rgba(245,158,11,0.12));
    }

    .header h1 {
      font-size: 20px;
      letter-spacing: 0.4px;
    }

    .header p {
      color: var(--muted);
      margin-top: 4px;
      font-size: 12px;
    }

    .chat {
      padding: 20px 24px;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 14px;
      background: rgba(15, 23, 42, 0.4);
    }

    .msg {
      display: flex;
      gap: 10px;
      align-items: flex-start;
      animation: rise 0.3s ease-out;
    }

    .msg.user { justify-content: flex-end; }

    .bubble {
      max-width: 75%;
      padding: 12px 14px;
      border-radius: 16px;
      border: 1px solid var(--border);
      background: #111827;
      line-height: 1.4;
      font-size: 14px;
      box-shadow: 0 10px 25px rgba(0,0,0,0.2);
    }

    .msg.user .bubble {
      background: linear-gradient(135deg, rgba(34,197,94,0.2), rgba(34,197,94,0.06));
      border-color: rgba(34,197,94,0.35);
    }

    .msg.bot .bubble {
      background: linear-gradient(135deg, rgba(245,158,11,0.18), rgba(17,24,39,0.4));
      border-color: rgba(245,158,11,0.35);
    }

    .meta {
      margin-top: 6px;
      font-size: 11px;
      color: var(--muted);
    }

    .input {
      border-top: 1px solid var(--border);
      padding: 16px;
      display: flex;
      gap: 10px;
      background: #0b1220;
    }

    input[type="text"] {
      flex: 1;
      padding: 12px 14px;
      border-radius: 12px;
      border: 1px solid var(--border);
      background: #0b0f14;
      color: var(--text);
      font-size: 14px;
      outline: none;
    }

    button {
      padding: 12px 18px;
      border-radius: 12px;
      border: none;
      background: linear-gradient(135deg, #22c55e, #16a34a);
      color: #0b0f14;
      font-weight: 700;
      cursor: pointer;
      transition: transform 0.15s ease;
    }

    button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }

    button:hover { transform: translateY(-1px); }

    @keyframes rise {
      from { opacity: 0; transform: translateY(6px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @media (max-width: 600px) {
      .app { border-radius: 16px; }
      .bubble { max-width: 90%; }
    }
  </style>
</head>
<body>
  <div class="app">
    <div class="header">
      <h1>BFSI Conversational AI</h1>
      <p>Enterprise-grade banking assistant</p>
    </div>

    <div class="chat" id="chat">
      <div class="msg bot">
        <div class="bubble">Hello. Ask about loans, EMI, account updates, or policies.</div>
      </div>
    </div>

    <div class="input">
      <input id="queryInput" type="text" placeholder="Ask about loans, EMI, accounts..." />
      <button id="sendButton">Send</button>
    </div>
  </div>

  <script>
    const chat = document.getElementById('chat');
    const queryInput = document.getElementById('queryInput');
    const sendButton = document.getElementById('sendButton');
    const sessionId = 'session_' + Date.now();

    function addMessage(text, type, meta) {
      const msg = document.createElement('div');
      msg.className = 'msg ' + type;

      const bubble = document.createElement('div');
      bubble.className = 'bubble';
      bubble.textContent = text;

      if (meta) {
        const metaEl = document.createElement('div');
        metaEl.className = 'meta';
        metaEl.textContent = meta;
        bubble.appendChild(metaEl);
      }

      msg.appendChild(bubble);
      chat.appendChild(msg);
      chat.scrollTop = chat.scrollHeight;
    }

    async function sendQuery() {
      const query = queryInput.value.trim();
      if (!query) return;

      queryInput.disabled = true;
      sendButton.disabled = true;

      addMessage(query, 'user');
      queryInput.value = '';

      addMessage('Thinking...', 'bot');

      try {
        const response = await fetch('/api/query', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ query, session_id: sessionId })
        });

        const data = await response.json();

        chat.removeChild(chat.lastChild);

        const meta = `Tier ${data.tier_used} | ${data.intent} | ${(data.confidence * 100).toFixed(0)}% | ${data.processing_time_ms.toFixed(0)}ms`;
        addMessage(data.response, 'bot', meta);

      } catch (err) {
        chat.removeChild(chat.lastChild);
        addMessage('Error: could not connect to server.', 'bot');
      }

      queryInput.disabled = false;
      sendButton.disabled = false;
      queryInput.focus();
    }

    sendButton.addEventListener('click', sendQuery);
    queryInput.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') sendQuery();
    });
  </script>
</body>
</html>
